<!DOCTYPE html>
<html>
  <head>
    <title>MARCHING ORDERS COMMENTS</title>
    <link rel="stylesheet" href="./style.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
<!--     <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script type="text/babel" src="js/Slider.js"></script>
 -->    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous"> -->
    <!-- <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"/> -->
  </head>

  <body>

    <main class="page-body">
      <br>
      <div class="select-slider">
        <div class="triangleleft" onclick="switchCategoryLeft()"></div>
        <div id="category">Category</div>
        <div id="count-responses"></div>
        <select id="mySelect" style="display:none;" onchange="myFunction()">
          <option value="topic">Category</option>
        </select>
        <div class="triangleright" onclick="switchCategoryRight()"></div>
      </div>
      <br>
      <div id="category-description"></div>
      <br>
      <p id="demo"></p>
      <div id="content" class="bubble-list"></div>
    </main>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
      crossorigin="anonymous"></script>

    <script type="text/javascript" language="javascript">
      $(document).ready(function() {
          //Save category descriptions to local storage to be accessed later
          $.getJSON('category_descriptions.json', function(cd) {
            localStorage.setItem('category-descriptions', JSON.stringify(cd));
          });

          $.getJSON('comments_all.json', function(jd) {
            topic_list=[];
            for (i = 1; i < Object.keys(jd).length+1; i++) {
              var myArray = jd[i].Category.toLowerCase().trim().match(/[^,\s][^\,]*[^,\s]*/g);
              // alert(myArray);
              // topic_list.push(jd[i].Category);
              // alert(myArray);
              topic_list.push.apply(topic_list, myArray);
            }
            // alert(topic_list);
            var uniqueList = topic_list.filter( onlyUnique );
            var  count = {};
            topic_list.forEach(function(i) { count[i] = (count[i]||0) + 1;});
            uniqueList.sort();
            // alert(uniqueList);
            //Store select unique list to local storage to be used by arrows when selecting
            localStorage.setItem('select-list', JSON.stringify(uniqueList));
            localStorage.setItem('count-list', JSON.stringify(count));            
            var myList = document.getElementById('mySelect');
            var listContent = '';
            for (i = 0; i < uniqueList.length; i++) {
              listContent = listContent + '<option value="' + uniqueList[i] + '">' + uniqueList[i] + '</option>';
            }
            myList.innerHTML = listContent;
            let category = 'ageism';
            listMajors(category);
            $("#mySelect").val(category);
            setDescription(category);
            $("#category").text(category.replace("-"," "));
            $("#count-responses").text(count[category] + " Responses");
            $(".triangleleft").css({"color":"#4f9dba","cursor":"auto"});
          });

        function onlyUnique(value, index, self) {
            return self.indexOf(value) == index;
        }
      });

      function listMajors(x) {
        //document.getElementById('content').innerHTML = '<strong>Category</strong> =  '+ x + '\n';
        var pre = document.getElementById('content');
        pre.innerHTML= '';
        $.getJSON('comments_all.json', function(jd) {
          var animationKey = 0;
          for (i = 1; i < Object.keys(jd).length+1; i++) {

            var myArray = jd[i].Category.toLowerCase().trim().match(/[^,\s][^\,]*[^,\s]*/g);
            // if (jd[i].Category==x) {
              // alert(x);
            if (myArray.indexOf(x) != -1) {
              var pre = document.getElementById('content');
              var textBubble = '<div class="bubble-wrapper" style="animation-delay:' + [animationKey] + 's"><div><div class="bubble-body">' + jd[i]["comment-body"] + '</div><div class="bubble-footer u-text-white">' + jd[i]["Category"] + ":  " + jd[i]["agrees"] + " Likes   " + '</div></div></div>';
              pre.innerHTML += textBubble;
              animationKey++;
            }
          }
        });
      }

      function myFunction() {
        var x = document.getElementById("mySelect").value;
        //document.getElementById("demo").innerHTML = 'You selected: ' + x ;
        // alert('myFunction ' + x);
        listMajors(x);
      }

      function switchCategory(category,direction) {
        listMajors(category);
        setDescription(category);
        var count = JSON.parse(localStorage.getItem('count-list'));
        $("#mySelect").val(category);
        $("#count-responses").text(count[category] + " Responses");
        if (['cfpb','dc','daca','lbgtq','lgbtq'].includes(category)) 
          category = category.toUpperCase();
        $("#category").text(category.replace("-"," "));
        if (direction=="left") {
          $("#category").css({"opacity": 0, "left":"-=100"});
          $("#category").animate({left:0, opacity:1},1000);
          $("#count-responses").css({"opacity": 0, "left":"-=100"});
          $("#count-responses").animate({left:0, opacity:1},1000);
        } else if (direction=="right") {
          $("#category").css({"opacity": 0, "left":"+=100"});
          $("#category").animate({left:0, opacity:1},1000);
          $("#count-responses").css({"opacity": 0, "left":"+=100"});
          $("#count-responses").animate({left:0, opacity:1},1000);
        }
      }

      function switchCategoryLeft() {
        $(".triangleright").css({"color":"#fff","cursor":"pointer"});
        var x = document.getElementById("mySelect").value;
        var selectList = JSON.parse(localStorage.getItem('select-list'));
        for (i = 0; i < selectList.length; i++) {
          if (selectList[i] == x) {
            let category = (i == 0 ? selectList[0] : selectList[i-1]);
            if(i==1)
              $(".triangleleft").css({"color":"#4f9dba","cursor":"auto"});
            switchCategory(category,"left");
            return;
          }
        }
      }
      function switchCategoryRight() {
        $(".triangleleft").css({"color":"#fff","cursor":"pointer"});
        var x = document.getElementById("mySelect").value;
        var selectList = JSON.parse(localStorage.getItem('select-list'));
        for (i = 0; i < selectList.length; i++) {
          if (selectList[i] == x) {
            let category = (i == selectList.length-1 ? selectList[selectList.length-1] : selectList[i+1]);
            if (i == selectList.length-2)
              $(".triangleright").css({"color":"#4f9dba","cursor":"auto"});
            switchCategory(category,"right");
            return;
          }
        }
      }

      function setDescription(category) {
        var categoryDescriptions = JSON.parse(localStorage.getItem('category-descriptions'));
        $("#category-description").text('');
        for (var i = 0; i < categoryDescriptions.length; i++ ) {
          if (categoryDescriptions[i].categories.includes(category)) {
            for (var y = 0; y < categoryDescriptions[i].description.length; y++ ) {
              $("#category-description").append("<p>" + categoryDescriptions[i].description[y] + "</p>");
            }
            $("#category-description").fadeIn(1000);
            return;
          }          
        }
        $("#category-description").hide();         
      }
    </script>
  </body>
</html>
